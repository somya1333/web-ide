!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).ReactFlipToolkitCore=e()}(this,function(){"use strict";function t(t){if(t.constructor!==Array)throw new TypeError("Expected array.");if(16===t.length)return t;if(6===t.length){var i=e();return i[0]=t[0],i[1]=t[1],i[4]=t[2],i[5]=t[3],i[12]=t[4],i[13]=t[5],i}throw new RangeError("Expected array with either 6 or 16 values.")}function e(){for(var t=[],e=0;e<16;e++)e%5==0?t.push(1):t.push(0);return t}function i(e,i){for(var n=t(e),r=t(i),a=[],o=0;o<4;o++)for(var s=[n[o],n[o+4],n[o+8],n[o+12]],l=0;l<4;l++){var p=4*l,u=[r[p],r[p+1],r[p+2],r[p+3]],c=s[0]*u[0]+s[1]*u[1]+s[2]*u[2]+s[3]*u[3];a[o+p]=c}return a}var n=function(t){return"number"==typeof t},r=function(t){return Array.prototype.slice.apply(t)};function a(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return e.forEach(function(e){if(e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}),t}var o,s={noWobble:{stiffness:200,damping:26},gentle:{stiffness:120,damping:14},veryGentle:{stiffness:130,damping:17},wobbly:{stiffness:180,damping:12},stiff:{stiffness:260,damping:26}},l=function(t){var e=void 0===t?{}:t,i=e.flipperSpring,n=e.flippedSpring,r=function(t){return e=t,"[object Object]"===Object.prototype.toString.call(e)?t:s[t]?s[t]:{};var e};return a({},s.noWobble,r(i),r(n))},p=function(t,e,i){var n=t(e).map(function(t){return t.dataset.flipId});return i.filter(function(t){return n.indexOf(t)>-1})};function u(t){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function f(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function d(t,e,i){return e&&f(t.prototype,e),i&&f(t,i),t}"undefined"!=typeof window&&(o=window.requestAnimationFrame);var h=o=o||function(t){window.setTimeout(t,1e3/60)};var g=Date.now(),m="object"===("undefined"==typeof performance?"undefined":u(performance))&&"function"==typeof performance.now?function(){return performance.now()}:function(){return Date.now()-g};function v(t,e){var i=t.indexOf(e);-1!==i&&t.splice(i,1)}var y=function(){function t(){c(this,t)}return d(t,[{key:"run",value:function(){var t=this;h(function(){t.springSystem.loop(m())})}}]),t}(),S=function t(){c(this,t),this.position=0,this.velocity=0},E=function(){function t(e){c(this,t),this._id="s"+t._ID++,this._springSystem=e,this.listeners=[],this._startValue=0,this._currentState=new S,this._displacementFromRestThreshold=.001,this._endValue=0,this._overshootClampingEnabled=!1,this._previousState=new S,this._restSpeedThreshold=.001,this._tempState=new S,this._timeAccumulator=0,this._wasAtRest=!0}return d(t,[{key:"getId",value:function(){return this._id}},{key:"destroy",value:function(){this.listeners=[],this._springSystem.deregisterSpring(this)}},{key:"setSpringConfig",value:function(t){return this._springConfig=t,this}},{key:"getCurrentValue",value:function(){return this._currentState.position}},{key:"getDisplacementDistanceForState",value:function(t){return Math.abs(this._endValue-t.position)}},{key:"setEndValue",value:function(t){if(this._endValue===t&&this.isAtRest())return this;this._startValue=this.getCurrentValue(),this._endValue=t,this._springSystem.activateSpring(this.getId());for(var e=0,i=this.listeners.length;e<i;e++){var n=this.listeners[e].onSpringEndStateChange;n&&n(this)}return this}},{key:"setVelocity",value:function(t){return t===this._currentState.velocity?this:(this._currentState.velocity=t,this._springSystem.activateSpring(this.getId()),this)}},{key:"setOvershootClampingEnabled",value:function(t){return this._overshootClampingEnabled=t,this}},{key:"isOvershooting",value:function(){var t=this._startValue,e=this._endValue;return this._springConfig.tension>0&&(t<e&&this.getCurrentValue()>e||t>e&&this.getCurrentValue()<e)}},{key:"advance",value:function(e,i){var n=this.isAtRest();if(!n||!this._wasAtRest){var r=i;i>t.MAX_DELTA_TIME_SEC&&(r=t.MAX_DELTA_TIME_SEC),this._timeAccumulator+=r;for(var a,o,s,l,p,u,c,f,d=this._springConfig.tension,h=this._springConfig.friction,g=this._currentState.position,m=this._currentState.velocity,v=this._tempState.position,y=this._tempState.velocity;this._timeAccumulator>=t.SOLVER_TIMESTEP_SEC;)this._timeAccumulator-=t.SOLVER_TIMESTEP_SEC,this._timeAccumulator<t.SOLVER_TIMESTEP_SEC&&(this._previousState.position=g,this._previousState.velocity=m),a=m,o=d*(this._endValue-v)-h*m,v=g+a*t.SOLVER_TIMESTEP_SEC*.5,s=y=m+o*t.SOLVER_TIMESTEP_SEC*.5,l=d*(this._endValue-v)-h*y,v=g+s*t.SOLVER_TIMESTEP_SEC*.5,p=y=m+l*t.SOLVER_TIMESTEP_SEC*.5,u=d*(this._endValue-v)-h*y,v=g+p*t.SOLVER_TIMESTEP_SEC,c=y=m+u*t.SOLVER_TIMESTEP_SEC,f=1/6*(o+2*(l+u)+(d*(this._endValue-v)-h*y)),g+=1/6*(a+2*(s+p)+c)*t.SOLVER_TIMESTEP_SEC,m+=f*t.SOLVER_TIMESTEP_SEC;this._tempState.position=v,this._tempState.velocity=y,this._currentState.position=g,this._currentState.velocity=m,this._timeAccumulator>0&&this._interpolate(this._timeAccumulator/t.SOLVER_TIMESTEP_SEC),(this.isAtRest()||this._overshootClampingEnabled&&this.isOvershooting())&&(this._springConfig.tension>0?(this._startValue=this._endValue,this._currentState.position=this._endValue):(this._endValue=this._currentState.position,this._startValue=this._endValue),this.setVelocity(0),n=!0);var S=!1;this._wasAtRest&&(this._wasAtRest=!1,S=!0);var E=!1;n&&(this._wasAtRest=!0,E=!0),this.notifyPositionUpdated(S,E)}}},{key:"notifyPositionUpdated",value:function(t,e){for(var i=0,n=this.listeners.length;i<n;i++){var r=this.listeners[i];t&&r.onSpringActivate&&r.onSpringActivate(this),r.onSpringUpdate&&r.onSpringUpdate(this),e&&r.onSpringAtRest&&r.onSpringAtRest(this)}}},{key:"systemShouldAdvance",value:function(){return!this.isAtRest()||!this.wasAtRest()}},{key:"wasAtRest",value:function(){return this._wasAtRest}},{key:"isAtRest",value:function(){return Math.abs(this._currentState.velocity)<this._restSpeedThreshold&&(this.getDisplacementDistanceForState(this._currentState)<=this._displacementFromRestThreshold||0===this._springConfig.tension)}},{key:"_interpolate",value:function(t){this._currentState.position=this._currentState.position*t+this._previousState.position*(1-t),this._currentState.velocity=this._currentState.velocity*t+this._previousState.velocity*(1-t)}},{key:"addListener",value:function(t){return this.listeners.push(t),this}},{key:"removeListener",value:function(t){return v(this.listeners,t),this}}]),t}();E._ID=0,E.MAX_DELTA_TIME_SEC=.064,E.SOLVER_TIMESTEP_SEC=.001;var _=new(function(){function t(e){c(this,t),this.looper=e||new y,this.looper.springSystem=this,this.listeners=[],this._activeSprings=[],this._idleSpringIndices=[],this._isIdle=!0,this._lastTimeMillis=-1,this._springRegistry={}}return d(t,[{key:"createSpring",value:function(t,e){return this.createSpringWithConfig({tension:t,friction:e})}},{key:"createSpringWithConfig",value:function(t){var e=new E(this);return this.registerSpring(e),e.setSpringConfig(t),e}},{key:"getIsIdle",value:function(){return this._isIdle}},{key:"registerSpring",value:function(t){this._springRegistry[t.getId()]=t}},{key:"deregisterSpring",value:function(t){v(this._activeSprings,t),delete this._springRegistry[t.getId()]}},{key:"advance",value:function(t,e){for(var i=this;this._idleSpringIndices.length>0;)this._idleSpringIndices.pop();for(this._activeSprings.filter(Boolean).forEach(function(n){n.systemShouldAdvance()?n.advance(t/1e3,e/1e3):i._idleSpringIndices.push(i._activeSprings.indexOf(n))});this._idleSpringIndices.length>0;){var n=this._idleSpringIndices.pop();n>=0&&this._activeSprings.splice(n,1)}}},{key:"loop",value:function(t){var e;-1===this._lastTimeMillis&&(this._lastTimeMillis=t-1);var i=t-this._lastTimeMillis;this._lastTimeMillis=t;var n=0,r=this.listeners.length;for(n=0;n<r;n++)(e=this.listeners[n]).onBeforeIntegrate&&e.onBeforeIntegrate(this);for(this.advance(t,i),0===this._activeSprings.length&&(this._isIdle=!0,this._lastTimeMillis=-1),n=0;n<r;n++)(e=this.listeners[n]).onAfterIntegrate&&e.onAfterIntegrate(this);this._isIdle||this.looper.run()}},{key:"activateSpring",value:function(t){var e=this._springRegistry[t];-1===this._activeSprings.indexOf(e)&&this._activeSprings.push(e),this.getIsIdle()&&(this._isIdle=!1,this.looper.run())}}]),t}()),C=function(t){var e=t.springConfig,i=e.stiffness,n=e.damping,r=e.overshootClamping,a=t.noOp,o=t.onSpringActivate,s=t.getOnUpdateFunc,l=t.onAnimationEnd;if(a)return null;var p=_.createSpring(i,n);return p.setOvershootClampingEnabled(!!r),p.addListener({onSpringActivate:o,onSpringUpdate:s(p.destroy.bind(p)),onSpringAtRest:function(){p.destroy(),l()}}),p},I=function(t){t&&t.forEach(function(t){!function(t){var e=C(t);e?e.setEndValue(1):t.onSpringActivate()}(t),I(t.immediateChildren)})},b=function(t){var e=t.staggerConfig,i=function(t){t&&Object.keys(t).length&&Object.keys(t).forEach(function(i){return function(t,e){if(void 0===e&&(e={}),t&&t.length){e.reverse&&t.reverse();var i=e.speed?1+Math.max(Math.min(e.speed,0),1):1.1,n=1/Math.max(Math.min(t.length,100),10),r=t.filter(function(t){return!t.noOp}).map(function(t,e){var a=t.getOnUpdateFunc;return t.getOnUpdateFunc=function(t){var o=a(t);return function(t){var a=t.getCurrentValue();a>n&&r[e+1]&&r[e+1].setEndValue(Math.min(a*i,1)),o(t)}},t}).map(function(t){return C(t)});r[0]&&r[0].setEndValue(1)}}(t[i],e[i])})},n=function(t){var e=t.flipDataDict,i=t.topLevelChildren,n=t.initiateStaggeredAnimations,r={root:{staggeredChildren:{},immediateChildren:[]}},a=function(t,i){var r=e[i];r&&(r.stagger?t.staggeredChildren[r.stagger]?t.staggeredChildren[r.stagger].push(r):t.staggeredChildren[r.stagger]=[r]:t.immediateChildren.push(r),r.onSpringActivate=function(){I(r.immediateChildren),n(r.staggeredChildren)},r.staggeredChildren={},r.immediateChildren=[],r.childIds.forEach(function(t){return a(r,t)}))};return i.forEach(function(t){a(r.root,t)}),r}({flipDataDict:t.flipDataDict,topLevelChildren:t.topLevelChildren,initiateStaggeredAnimations:i});I(n.root.immediateChildren),i(n.root.staggeredChildren)},A=function(t){return[0,1,4,5,12,13].map(function(e){return t[e]})},w=function(t){var e=t.top,i=t.bottom,n=t.left,r=t.right;return e<window.innerHeight&&i>0&&n<window.innerWidth&&r>0},O=function(t,e,i){return t+(e-t)*i},T=function(o){var s,u,c=o.flippedIds,f=o.flipCallbacks,d=o.inProgressAnimations,h=o.flippedElementPositionsBeforeUpdate,g=o.flippedElementPositionsAfterUpdate,m=o.applyTransformOrigin,v=o.spring,y=o.getElement,S=o.debug,E=o.staggerConfig,_=o.decisionData,C=void 0===_?{}:_,I=o.scopedSelector,T=o.retainTransform,x=o.onComplete,k=new Promise(function(t){s=t});if(x&&k.then(x),!c.length)return function(){return s([]),k};var V=[],M=y(c[0]),P=M?M.ownerDocument.querySelector("body"):document.querySelector("body");S&&console.error('[react-flip-toolkit]\nThe "debug" prop is set to true. All FLIP animations will return at the beginning of the transition.');var R,D=(R=c.reduce(function(t,e){return t[e]=(t[e]||0)+1,t},{}),Object.keys(R).filter(function(t){return R[t]>1}));D.length&&console.error("[react-flip-toolkit]\nThere are currently multiple elements with the same flipId on the page.\nThe animation will only work if each Flipped component has a unique flipId.\nDuplicate flipId"+(D.length>1?"s":"")+": "+D.join("\n"));var F=c.map(function(o){var p=h[o].rect,c=g[o].rect,S=h[o].opacity,E=g[o].opacity,_=c.width<1||c.height<1;if(!w(p)&&!w(c))return!1;if(0===p.width&&0===c.width||0===p.height&&0===c.height)return!1;var I=y(o);if(!I)return!1;var b=JSON.parse(I.dataset.flipConfig),x=l({flipperSpring:v,flippedSpring:b.spring}),k=!0===b.stagger?"default":b.stagger,M={element:I,id:o,stagger:k,springConfig:x,noOp:!0};if(f[o]&&f[o].shouldFlip&&!f[o].shouldFlip(C.prev,C.current))return M;var R=Math.abs(p.left-c.left)+Math.abs(p.top-c.top),D=Math.abs(p.width-c.width)+Math.abs(p.height-c.height),F=Math.abs(E-S);if(R<.5&&D<.5&&F<.01)return M;M.noOp=!1;var U,L,j=function(i){if("string"==typeof i){var n=i.match(/matrix(3d)?\(([^)]+)\)/);if(n)return t(n[2].split(", ").map(parseFloat))}return e()}(g[o].transform),B={matrix:j},q={matrix:[]},X=[j];b.translate&&(X.push((U=p.left-c.left,(L=e())[12]=U,L)),X.push(function(t){var i=e();return i[13]=t,i}(p.top-c.top))),b.scale&&(X.push(function(t){var i=e();return i[0]=t,i}(Math.max(p.width,1)/Math.max(c.width,1))),X.push(function(t){var i=e();return i[5]=t,i}(Math.max(p.height,1)/Math.max(c.height,1)))),b.opacity&&(q.opacity=S,B.opacity=E);var W=[];if(!f[o]||!f[o].shouldInvert||f[o].shouldInvert(C.prev,C.current)){var N=function(t,e){return r(t.querySelectorAll('[data-inverse-flip-id="'+e+'"]'))}(I,o);W=N.map(function(t){return[t,JSON.parse(t.dataset.flipConfig)]})}q.matrix=A(X.reduce(i)),B.matrix=A(B.matrix);var Y,K=function(t){var e=t.element,i=t.invertedChildren,r=t.body,a=t.retainTransform;return function(t){var o=t.matrix,s=t.opacity,l=t.forceMinVals;if(n(s)&&(e.style.opacity=s+""),l&&(e.style.minHeight="1px",e.style.minWidth="1px"),o){var p=function(t){return"matrix("+t.join(", ")+")"}(o);a&&"matrix(1, 0, 0, 1, 0, 0)"===p&&(p="matrix(1, 0.00001, -0.00001, 1, 0, 0)"),e.style.transform=p,i&&function(t){var e=t.invertedChildren,i=t.matrix,n=t.body;e.forEach(function(t){var e=t[0],r=t[1];if(n.contains(e)){var a=i[0],o=i[3],s=i[4],l=i[5],p={translateX:0,translateY:0,scaleX:1,scaleY:1},u="";r.translate&&(p.translateX=-s/a,p.translateY=-l/o,u+="translate("+p.translateX+"px, "+p.translateY+"px)"),r.scale&&(p.scaleX=1/a,p.scaleY=1/o,u+=" scale("+p.scaleX+", "+p.scaleY+")"),e.style.transform=u}})}({invertedChildren:i,matrix:o,body:r})}}}({element:I,invertedChildren:W,body:P,retainTransform:T});if(f[o]&&f[o].onComplete){var J=f[o].onComplete;Y=function(){return J(I,C.prev,C.current)}}var z=n(q.opacity)&&n(B.opacity)&&q.opacity!==B.opacity,H=!1;return a({},M,{stagger:k,springConfig:x,getOnUpdateFunc:function(t){d[o]={stop:t,onComplete:Y};return function(e){f[o]&&f[o].onSpringUpdate&&f[o].onSpringUpdate(e.getCurrentValue()),H||(H=!0,f[o]&&f[o].onStart&&f[o].onStart(I,C.prev,C.current));var i=e.getCurrentValue();if(P.contains(I)){var n={matrix:[]};n.matrix=q.matrix.map(function(t,e){return O(t,B.matrix[e],i)}),z&&(n.opacity=O(q.opacity,B.opacity,i)),K(n)}else t()}},initializeFlip:function(){K({matrix:q.matrix,opacity:z?q.opacity:void 0,forceMinVals:_}),f[o]&&f[o].onStartImmediate&&f[o].onStartImmediate(I,C.prev,C.current),b.transformOrigin?I.style.transformOrigin=b.transformOrigin:m&&(I.style.transformOrigin="0 0"),W.forEach(function(t){var e=t[0],i=t[1];i.transformOrigin?e.style.transformOrigin=i.transformOrigin:m&&(e.style.transformOrigin="0 0")})},onAnimationEnd:function(){delete d[o],"function"==typeof Y&&Y(),I.style.transform="",_&&I&&(I.style.minHeight="",I.style.minWidth=""),V.push(o),V.length>=u.length&&s(V)}})}).filter(function(t){return t});if((u=F.filter(function(t){var e=t.initializeFlip;return Boolean(e)})).forEach(function(t){return(0,t.initializeFlip)()}),S)return function(){};var U=F.reduce(function(t,e){return t[e.id]=e,t},{}),L=function(t){var e=t.flipDataDict,i=t.flippedIds,n=t.scopedSelector,a={},o=function(t,r,s){var l=t+" [data-flip-id]",u=p(n,l,i),c=s.filter(function(t){return-1===u.indexOf(t)});a[r]=c,c.forEach(function(t){e[t]&&(e[t].level=r)}),0!==u.length&&o(l,r+1,u)};return o("[data-flip-id]",0,p(n,"[data-flip-id]",i)),Object.keys(e).forEach(function(t){var n=e[t];n.childIds=p(function(t){return r(n.element.querySelectorAll(t))},"[data-flip-id]",i),n.childIds=n.childIds.filter(function(t){return a[n.level+1]&&a[n.level+1].indexOf(t)>-1})}),a[0]}({flipDataDict:U,flippedIds:c,scopedSelector:I});return function(){return u.length||s([]),b({topLevelChildren:L,flipDataDict:U,staggerConfig:E}),k}},x=function(t,e){var i;return a(t,((i={})[e[0]]=e[1],i))},k=function(t,e){return r(e?document.querySelectorAll('[data-portal-key="'+e+'"]'):t.querySelectorAll("[data-flip-id]"))},V=function(t,e){return e?function(t){return r(document.querySelectorAll("[data-portal-key="+e+"]"+t))}:t?function(e){return r(t.querySelectorAll(e))}:function(){return[]}},M=function(t){var e=t.cachedOrderedFlipIds,i=void 0===e?[]:e,n=t.inProgressAnimations,r=void 0===n?{}:n,o=t.flippedElementPositionsBeforeUpdate,s=void 0===o?{}:o,l=t.flipCallbacks,p=void 0===l?{}:l,u=t.containerEl,c=t.applyTransformOrigin,f=t.spring,d=t.debug,h=t.portalKey,g=t.staggerConfig,m=void 0===g?{}:g,v=t.decisionData,y=void 0===v?{}:v,S=t.handleEnterUpdateDelete,E=t.retainTransform,_=t.onComplete,C=function(t){var e=t.element,i=t.portalKey;return k(e,i).map(function(t){var e=window.getComputedStyle(t),i=t.getBoundingClientRect();return[t.dataset.flipId,{rect:i,opacity:parseFloat(e.opacity),transform:e.transform}]}).reduce(x,{})}({element:u,portalKey:h}),I=V(u,h),b=function(t,e){if(!t&&!e)throw new Error("either portalKey or element must be provided");return function(i){return V(t,e)('[data-flip-id="'+i+'"]')[0]}}(u,h),A=function(t){return s[t]&&C[t]},w=Object.keys(s).concat(Object.keys(C)).filter(function(t){return!A(t)}),O={flipCallbacks:p,getElement:b,flippedElementPositionsBeforeUpdate:s,flippedElementPositionsAfterUpdate:C,inProgressAnimations:r},M=function(t){var e,i=t.unflippedIds,n=t.flipCallbacks,r=t.getElement,a=t.flippedElementPositionsBeforeUpdate,o=t.flippedElementPositionsAfterUpdate,s=t.inProgressAnimations,l=i.filter(function(t){return o[t]&&n[t]}),p=i.filter(function(t){return a[t]&&n[t]&&n[t].onExit}),u=new Promise(function(t){e=t}),c=[],f=0,d=p.map(function(t,i){var r=a[t].domDataForExitAnimations,o=r.element,l=r.parent,p=r.childPosition,u=p.top,d=p.left,h=p.width,g=p.height;"static"===getComputedStyle(l).position&&(l.style.position="relative"),o.style.transform="matrix(1, 0, 0, 1, 0, 0)",o.style.position="absolute",o.style.top=u+"px",o.style.left=d+"px",o.style.height=g+"px",o.style.width=h+"px";var m=c.filter(function(t){return t[0]===l})[0];m||(m=[l,document.createDocumentFragment()],c.push(m)),m[1].appendChild(o),f+=1;var v=function(){try{l.removeChild(o)}catch(t){}finally{0==(f-=1)&&e()}};return s[t]={stop:v},function(){return n[t].onExit(o,i,v)}});c.forEach(function(t){var e=t[0],i=t[1];e.appendChild(i)}),d.length||e();return{hideEnteringElements:function(){l.forEach(function(t){n[t]&&n[t].onAppear&&(r(t).style.opacity="0")})},animateEnteringElements:function(){l.forEach(function(t,e){var i=r(t);n[t]&&n[t].onAppear&&n[t].onAppear(i,e)})},animateExitingElements:function(){return d.forEach(function(t){return t()}),u}}}(a({},O,{unflippedIds:w})),P=M.hideEnteringElements,R=M.animateEnteringElements,D=M.animateExitingElements,F=a({},O,{flippedIds:i.filter(A),applyTransformOrigin:c,spring:f,debug:d,staggerConfig:m,decisionData:y,scopedSelector:I,retainTransform:E,onComplete:_}),U=T(F);S?S({hideEnteringElements:P,animateEnteringElements:R,animateExitingElements:D,animateFlippedElements:U}):(P(),D().then(R),U())},P=function(t){var e=t.element,i=t.flipCallbacks,n=void 0===i?{}:i,o=t.inProgressAnimations,s=void 0===o?{}:o,l=t.portalKey,p=k(e,l),u=r(e.querySelectorAll("[data-inverse-flip-id]")),c={},f=[],d={};p.filter(function(t){return n&&n[t.dataset.flipId]&&n[t.dataset.flipId].onExit}).forEach(function(t){var e=t.parentNode;if(t.closest){var i=t.closest("[data-exit-container]");i&&(e=i)}var n=f.findIndex(function(t){return t[0]===e});-1===n&&(f.push([e,e.getBoundingClientRect()]),n=f.length-1),c[t.dataset.flipId]=f[n][1],d[t.dataset.flipId]=e});var h=p.map(function(t){var e={},i=t.getBoundingClientRect();if(n&&n[t.dataset.flipId]&&n[t.dataset.flipId].onExit){var r=c[t.dataset.flipId];a(e,{element:t,parent:d[t.dataset.flipId],childPosition:{top:i.top-r.top,left:i.left-r.left,width:i.width,height:i.height}})}return[t.dataset.flipId,{rect:i,opacity:parseFloat(window.getComputedStyle(t).opacity||"1"),domDataForExitAnimations:e}]}).reduce(x,{});return function(t){Object.keys(t).forEach(function(e){t[e].stop&&t[e].stop(),delete t[e]})}(s),p.concat(u).forEach(function(t){t.style.transform="",t.style.opacity=""}),{flippedElementPositions:h,cachedOrderedFlipIds:p.map(function(t){return t.dataset.flipId})}};return function(){function t(t){this.applyTransformOrigin=!0,this.retainTransform=!1,a(this,t),this.inProgressAnimations={},this.flipCallbacks={},this.recordBeforeUpdate=this.recordBeforeUpdate.bind(this),this.onUpdate=this.onUpdate.bind(this),this.addFlipped=this.addFlipped.bind(this),this.addInverted=this.addInverted.bind(this)}return t.prototype.recordBeforeUpdate=function(){this.snapshot=P({element:this.element,flipCallbacks:this.flipCallbacks,inProgressAnimations:this.inProgressAnimations})},t.prototype.onUpdate=function(t,e){this.snapshot&&(M({flippedElementPositionsBeforeUpdate:this.snapshot.flippedElementPositions,cachedOrderedFlipIds:this.snapshot.cachedOrderedFlipIds,containerEl:this.element,inProgressAnimations:this.inProgressAnimations,flipCallbacks:this.flipCallbacks,applyTransformOrigin:this.applyTransformOrigin,spring:this.spring,debug:this.debug,staggerConfig:this.staggerConfig,handleEnterUpdateDelete:this.handleEnterUpdateDelete,retainTransform:this.retainTransform,decisionData:{prev:t,current:e},onComplete:this.onComplete}),delete this.snapshot)},t.prototype.addFlipped=function(t){var e=t.element,i=t.flipId,n=t.opacity,r=t.translate,o=t.scale,s=t.transformOrigin,l=t.spring,p=t.stagger,u=t.onAppear,c=t.onStart,f=t.onSpringUpdate,d=t.onComplete,h=t.onExit,g=t.shouldFlip,m=t.shouldInvert;if(!e)throw new Error("no element provided");if(!i)throw new Error("No flipId provided");var v={scale:o,translate:r,opacity:n,transformOrigin:s,spring:l,stagger:p};v.scale||v.translate||v.opacity||a(v,{translate:!0,scale:!0,opacity:!0}),i&&(e.dataset.flipId=i),e.dataset.flipConfig=JSON.stringify(v),this.flipCallbacks[i]={shouldFlip:g,shouldInvert:m,onAppear:u,onStart:c,onSpringUpdate:f,onComplete:d,onExit:h}},t.prototype.addInverted=function(t){var e=t.element,i=t.parent,n=t.opacity,r=t.translate,o=t.scale,s=t.transformOrigin;if(!e)throw new Error("no element provided");if(!i)throw new Error("parent must be provided");var l=i.dataset.flipId,p={scale:o,translate:r,opacity:n,transformOrigin:s};p.scale||p.translate||p.opacity||a(p,{translate:!0,scale:!0,opacity:!0}),e.dataset.inverseFlipId=l,e.dataset.flipConfig=JSON.stringify(p)},t}()});
//# sourceMappingURL=core.min.js.map
